<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="LoanMapper">

	<insert id="documentInsert"
			parameterType="kr.co.creator.vo.DocumentVO">
		insert into document ( busi_regi
							, jumin_chobon
							, cer_ingam
							, cer_budong
							, cer_dong
							,cer_income
							,cer_vat
							,cer_other
							,copy_id
							,copy_bankbook
							,chk_select
							,judge_status
							,project_num)
		values( #{busi_regi}
				, #{jumin_chobon}
				, #{cer_ingam}
				, #{cer_budong}
				, #{cer_dong}
				, #{cer_income}
				, #{cer_vat}
				, #{cer_other}
				, #{copy_id}
				, #{copy_bankbook}
				, #{chk_select}
				, 1
				, #{project_num})
		<selectKey resultType="String" keyProperty="document_num" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<insert id="insert_project"	parameterType="kr.co.creator.vo.ProjectVO">
			INSERT INTO project_list (busi_num, img, project_name, type, genre, grade, more_information, loan_bank_name,
									loan_amount, price, loan_period, repay_method, loan_class, judge_status, agree_chk_1, 
									agree_chk_2, agree_chk_3, agree_chk_4, agree_chk_5, agree_chk_6)
			VALUES (#{busi_num}, #{img}, #{project_name}, #{type}, #{genre}, #{grade}, #{more_information}, #{loan_bank_name},
					#{loan_amount}, #{price}, #{loan_period}, #{repay_method}, #{loan_class}, 1, #{agree_chk_1}, 
					#{agree_chk_2}, #{agree_chk_3}, #{agree_chk_4}, #{agree_chk_5}, #{agree_chk_6})
		<selectKey resultType="String" keyProperty="project_num" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<insert id="insert_guarantee" parameterType="kr.co.creator.vo.GuaranteeVO">
		INSERT INTO guarantee (guarantee_type, object_type, guarantee_img, debtor_type, business_type, guarantee_name, 
								supply_area, exclusive_area, map, location, comple_year, connoisseur, judge_status, 
								reference_file1, reference_file2, reference_file3, project_num)
		VALUES (#{guarantee_type}, #{object_type}, #{guarantee_img}, #{debtor_type}, #{business_type}, #{guarantee_name}, 
				#{supply_area}, #{exclusive_area}, #{map}, #{location}, #{comple_year}, #{connoisseur}, 1, 
				#{reference_file1}, #{reference_file2}, #{reference_file3}, #{project_num})
		<selectKey resultType="String" keyProperty="guarantee_num" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
		
	</insert>
	
	<select id="RepaySelect" parameterType="kr.co.creator.vo.RepayVO" resultType="java.lang.String">
		SELECT count(loan_history) refund_count
		FROM repay_list
		WHERE repay_num = #{repay_num}
	</select>

</mapper>